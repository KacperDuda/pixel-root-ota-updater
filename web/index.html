<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Root OTA Flasher (WebUSB)</title>
    <link rel="stylesheet" href="style.css">
    <!-- Using ES Modules for JS -->
    <script type="module" src="app.js"></script>
</head>

<body>

    <!-- Top Bar -->
    <div class="top-bar">
        <div id="device-info">
            Pixel Flasher <span style="color:var(--accent-color)">v0.2</span>
        </div>
        <div>
            Status: <span id="connection-status" class="status-badge">DISCONNECTED</span>
            <span id="device-name" style="margin-left: 10px; color: #fff;"></span>
        </div>
    </div>

    <div class="container">
        <h1>Pixel Root OTA <span style="font-weight:700">Flasher</span></h1>

        <!-- Connection Section -->
        <div class="section">
            <h2>1. Connection</h2>
            <p style="font-size:0.9rem; color:#aaa; margin-bottom:1rem;">
                Connect your Pixel device in Fastboot/Bootloader mode. <br>
                (Power + Volume Down while booting).
            </p>
            <button id="connect-btn" class="btn">Connect Device (WebUSB)</button>
        </div>

        <!-- Configuration Section -->
        <div class="section">
            <h2>2. Configuration</h2>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label>
                        <input type="checkbox" id="chk-unlock">
                        Unlock Bootloader <span style="color:var(--danger-color); font-size:0.8em">(WIPES DATA)</span>
                    </label>
                    <label>
                        <input type="checkbox" id="chk-flash-key">
                        Flash AVB Custom Key
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" id="chk-flash-zip" checked disabled>
                        Flash System (update.zip)
                    </label>
                    <label>
                        <input type="checkbox" id="chk-lock">
                        Lock Bootloader <span style="color:var(--danger-color); font-size:0.8em">(RISK)</span>
                    </label>
                </div>
            </div>

            <!-- File Inputs -->
            <div style="margin-top: 1.5rem;">
                <label>
                    AVB Public Key (avb_pkmd.bin)
                    <input type="file" id="file-key" accept=".bin">
                </label>

                <label style="margin-top:1rem;">
                    System Image (update.zip)
                    <!-- Hidden file input, triggered by button or drag/drop in future -->
                    <input type="file" id="file-zip" accept=".zip">
                </label>

                <!-- Cloud Info Mockup (If fetching from cloud) -->
                <div id="cloud-info"
                    style="margin-top:10px; padding:10px; border:1px dashed var(--accent-color); border-radius:8px; display:none;">
                    <strong>Cloud Build:</strong> <span id="latest-build-date">Loading...</span><br>
                    <span id="target-file" style="font-size:0.8em; color:#aaa; word-break:break-all;">...</span>
                </div>
            </div>
        </div>

        <!-- Execution Section -->
        <div class="section">
            <h2>3. Execution</h2>
            <button id="flash-btn" class="btn" disabled>START FLASHING PROCESS</button>

            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>

            <div style="margin-top:1rem;">
                <label>Console Output:</label>
                <div id="log-container"></div>
            </div>
        </div>
    </div>

    <!-- Safety Modal -->
    <div id="warning-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--danger-color); border-bottom:none; justify-content:center;">⚠️ CRITICAL WARNING</h2>
            <p id="modal-message" style="font-size:1.1rem; line-height:1.6;">
                Message goes here...
            </p>

            <div id="modal-timer" class="modal-timer">60</div>

            <div class="modal-actions">
                <button id="btn-cancel" class="btn btn-secondary" style="width:auto; padding:0 2rem;">CANCEL</button>
                <button id="btn-confirm" class="btn modal-btn-confirm" style="width:auto; padding:0 2rem;">I UNDERSTAND,
                    PROCEED</button>
            </div>
        </div>
    </div>

</body>

</html>