<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Root OTA Flasher</title>
    <title>Pixel Root OTA Flasher</title>
    <!-- Bulma & Styles imported via JS in Vite -->
    <script type="module" src="app.ts"></script>
    <!-- Font Awesome (CDN is fine/easiest for icons without large bundle) -->
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
        integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc"
        crossorigin="anonymous"></script>
</head>

<body>

    <section class="section">
        <div class="container is-max-widescreen">
            <!-- Header -->
            <nav class="level mb-4">
                <div class="level-left">
                    <div class="level-item">
                        <h1 class="title is-4">
                            Pixel Root OTA <span class="has-text-primary">Flasher</span>
                        </h1>
                    </div>
                </div>
                <div class="level-right">
                    <div class="level-item">
                        <button id="theme-toggle" class="button is-rounded is-small">
                            <span class="icon"><i class="fas fa-moon"></i></span>
                            <span>Theme</span>
                        </button>
                    </div>
                    <div class="level-item">
                        <span id="device-name" class="mr-2 has-text-grey-light"></span>
                        <span class="tag is-dark" id="connection-status">DISCONNECTED</span>
                    </div>
                </div>
            </nav>

            <div class="columns is-desktop">

                <!-- LEFT COLUMN: Controls (1/3) -->
                <div class="column is-4">

                    <!-- 1. Connection Card -->
                    <div class="box">
                        <h2 class="subtitle is-5"><i class="fab fa-usb display-inline-block mr-2"></i> Connection</h2>

                        <div class="field has-addons">
                            <div class="control is-expanded">
                                <button id="connect-btn" class="button is-primary is-fullwidth">
                                    <span>Connect Device</span>
                                </button>
                            </div>
                        </div>
                        <p class="help">Device must be in <strong>Bootloader Mode</strong>.</p>

                        <!-- Optional ABD Reboot Helper Info -->
                        <article class="message is-small is-info mt-3" style="display:none;" id="fastboot-help">
                            <div class="message-body">
                                <strong>Tip:</strong> If ADB is on, run <code>adb reboot bootloader</code> manually.
                            </div>
                        </article>
                    </div>

                    <!-- 2. Configuration Card -->
                    <div class="box">
                        <h2 class="subtitle is-5"><i class="fas fa-cogs display-inline-block mr-2"></i> Configuration
                        </h2>

                        <!-- Version Selection -->
                        <div class="field">
                            <label class="label">Target System Version</label>
                            <div class="control has-icons-left">
                                <div class="select is-fullwidth">
                                    <select id="version-select">
                                        <option value="" disabled selected>Loading builds...</option>
                                    </select>
                                </div>
                                <div class="icon is-small is-left">
                                    <i class="fas fa-code-branch"></i>
                                </div>
                            </div>
                            <p class="help">Fetched from OTA Cloud Repository</p>
                        </div>

                        <!-- AVB Key Input (Cloud Managed) -->
                        <div class="field">
                            <label class="label">AVB Public Key</label>
                            <div class="control">
                                <span class="tag is-info is-light is-medium">
                                    <i class="fas fa-cloud-download-alt mr-2"></i>
                                    Cloud Managed (avb_pkmd.bin)
                                </span>
                            </div>
                            <p class="help">Key is automatically fetched from the build server.</p>
                        </div>

                        <hr>

                        <!-- Toggles -->
                        <div class="field">
                            <label class="checkbox display-block mb-2">
                                <input type="checkbox" id="chk-unlock">
                                <span class="ml-2">Unlock Bootloader <span
                                        class="tag is-danger is-light">Wipe</span></span>
                            </label>
                            <label class="checkbox display-block mb-2">
                                <input type="checkbox" id="chk-flash-key">
                                <span class="ml-2">Flash Custom AVB Key</span>
                            </label>
                            <label class="checkbox display-block mb-2">
                                <input type="checkbox" id="chk-flash-zip" checked disabled>
                                <span class="ml-2">Flash System Image <span
                                        class="tag is-success is-light">Auto</span></span>
                            </label>
                            <label class="checkbox display-block">
                                <input type="checkbox" id="chk-lock">
                                <span class="ml-2">Lock Bootloader <span
                                        class="tag is-warning is-light">Risk</span></span>
                            </label>
                        </div>
                    </div>

                    <!-- 3. Actions -->
                    <div class="box">
                        <button id="flash-btn" class="button is-success is-large is-fullwidth" disabled>
                            <span class="icon"><i class="fas fa-bolt"></i></span>
                            <span>START FLASHING</span>
                        </button>
                    </div>

                </div>

                <!-- RIGHT COLUMN: Console (2/3) -->
                <div class="column is-8">
                    <div class="box" style="height: 100%; display: flex; flex-direction: column;">
                        <h2 class="subtitle is-5"><i class="fas fa-terminal display-inline-block mr-2"></i> Live Console
                        </h2>

                        <div class="console-window"
                            style="flex-grow: 1; background-color: #1e1e1e; padding: 1rem; border-radius: 6px; overflow-y: auto; color: #00ff00; font-family: monospace; max-height: 80vh;">
                            <pre id="log-container"
                                style="background: transparent; color: inherit; padding: 0; margin: 0; white-space: pre-wrap; font-size: 0.9rem;">Welcome to Pixel Root OTA Flasher v2.0
Waiting for device...</pre>
                        </div>

                        <div class="mt-4">
                            <label class="label">Progress</label>
                            <progress id="progress-bar" class="progress is-success is-large" value="0"
                                max="100">0%</progress>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Native Safety Dialog -->
    <dialog id="warning-modal"
        style="padding: 0; border: none; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);">
        <div class="box" style="width: 400px; max-width: 90vw; background-color: #fff; border: 2px solid #ff3860;">
            <article class="media">
                <div class="media-left">
                    <span class="icon is-large has-text-danger">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </span>
                </div>
                <div class="media-content">
                    <div class="content">
                        <p>
                            <strong class="title is-4 has-text-danger">Warning</strong>
                            <br>
                            <span id="modal-message">Loading warning...</span>
                        </p>
                    </div>
                    <div class="has-text-centered my-4">
                        <span class="title is-1" id="modal-timer" style="font-family: monospace;">60</span><span
                            class="subtitle is-4">s</span>
                    </div>
                    <div class="buttons is-centered">
                        <button id="btn-cancel" class="button">Cancel</button>
                        <button id="btn-confirm" class="button is-danger">Confirm Action</button>
                    </div>
                </div>
            </article>
        </div>
    </dialog>

</body>

</html>